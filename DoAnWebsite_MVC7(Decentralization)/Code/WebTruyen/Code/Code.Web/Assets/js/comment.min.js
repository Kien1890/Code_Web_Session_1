
!function (t) { var e = { init: function (n) { return this.each(function () { var o = this, a = t(o).empty(); o.opt = t.extend(!0, {}, t.fn.raty.defaults, n), a.data("settings", o.opt), o.opt.number = e.between(o.opt.number, 0, 20), "/" != o.opt.path.substring(o.opt.path.length - 1, o.opt.path.length) && (o.opt.path += "/"), "function" == typeof o.opt.score && (o.opt.score = o.opt.score.call(o)), o.opt.score && (o.opt.score = e.between(o.opt.score, 0, o.opt.number)); for (var r = 1; r <= o.opt.number; r++)t("<img />", { src: o.opt.path + (!o.opt.score || o.opt.score < r ? o.opt.starOff : o.opt.starOn), alt: r, title: r <= o.opt.hints.length && null !== o.opt.hints[r - 1] ? o.opt.hints[r - 1] : r }).appendTo(o), o.opt.space && a.append(r < o.opt.number ? "&#160;" : ""); o.stars = a.children('img:not(".raty-cancel")'), o.score = t("<input />", { type: "hidden", name: o.opt.scoreName }).appendTo(o), o.opt.score && o.opt.score > 0 && (o.score.val(o.opt.score), e.roundStar.call(o, o.opt.score)), o.opt.iconRange && e.fill.call(o, o.opt.score), e.setTarget.call(o, o.opt.score, o.opt.targetKeep); var i = o.opt.space ? 4 : 0; o.opt.width || (o.opt.number, o.opt.size, o.opt.number); o.opt.cancel && (o.cancel = t("<img />", { src: o.opt.path + o.opt.cancelOff, alt: "x", title: o.opt.cancelHint, class: "raty-cancel" }), "left" == o.opt.cancelPlace ? a.prepend("&#160;").prepend(o.cancel) : a.append("&#160;").append(o.cancel), o.opt.size), o.opt.readOnly ? (e.fixHint.call(o), o.cancel && o.cancel.hide()) : (a.css("cursor", "pointer"), e.bindAction.call(o)) }) }, between: function (t, e, n) { return Math.min(Math.max(parseFloat(t), e), n) }, bindAction: function () { var n = this, o = t(n); o.mouseleave(function () { var t = n.score.val() || void 0; e.initialize.call(n, t), e.setTarget.call(n, t, n.opt.targetKeep), n.opt.mouseover && n.opt.mouseover.call(n, t) }); var a = n.opt.half ? "mousemove" : "mouseover"; n.opt.cancel && n.cancel.mouseenter(function () { t(this).attr("src", n.opt.path + n.opt.cancelOn), n.stars.attr("src", n.opt.path + n.opt.starOff), e.setTarget.call(n, null, !0), n.opt.mouseover && n.opt.mouseover.call(n, null) }).mouseleave(function () { t(this).attr("src", n.opt.path + n.opt.cancelOff), n.opt.mouseover && n.opt.mouseover.call(n, n.score.val() || null) }).click(function (t) { n.score.removeAttr("value"), n.opt.click && n.opt.click.call(n, null, t) }), n.stars.bind(a, function (a) { var r = parseInt(this.alt, 10); if (n.opt.half) { var i = parseFloat((a.pageX - t(this).offset().left) / n.opt.size), l = i > .5 ? 1 : .5; r = parseFloat(this.alt) - 1 + l, e.fill.call(n, r), n.opt.precision && (r = r - l + i), e.showHalf.call(n, r) } else e.fill.call(n, r); o.data("score", r), e.setTarget.call(n, r, !0), n.opt.mouseover && n.opt.mouseover.call(n, r, a) }).click(function (t) { n.score.val(n.opt.half || n.opt.precision ? o.data("score") : this.alt), n.opt.click && n.opt.click.call(n, n.score.val(), t) }) }, cancel: function (n) { return t(this).each(function () { var o = this; if (!0 === t(o).data("readonly")) return this; n ? e.click.call(o, null) : e.score.call(o, null), o.score.removeAttr("value") }) }, click: function (n) { return t(this).each(function () { if (!0 === t(this).data("readonly")) return this; e.initialize.call(this, n), this.opt.click ? this.opt.click.call(this, n) : e.error.call(this, 'you must add the "click: function(score, evt) { }" callback.'), e.setTarget.call(this, n, !0) }) }, error: function (e) { t(this).html(e), t.error(e) }, fill: function (t) { for (var e, n, o, a = this, r = a.stars.length, i = 0, l = 1; l <= r; l++)e = a.stars.eq(l - 1), a.opt.iconRange && a.opt.iconRange.length > i ? (n = a.opt.iconRange[i], o = a.opt.single ? l == t ? n.on || a.opt.starOn : n.off || a.opt.starOff : l <= t ? n.on || a.opt.starOn : n.off || a.opt.starOff, l <= n.range && e.attr("src", a.opt.path + o), l == n.range && i++) : (o = a.opt.single ? l == t ? a.opt.starOn : a.opt.starOff : l <= t ? a.opt.starOn : a.opt.starOff, e.attr("src", a.opt.path + o)) }, fixHint: function () { var e = t(this), n = parseInt(this.score.val(), 10), o = this.opt.noRatedMsg; !isNaN(n) && n > 0 && (o = n <= this.opt.hints.length && null !== this.opt.hints[n - 1] ? this.opt.hints[n - 1] : n), e.data("readonly", !0).css("cursor", "default").attr("title", o), this.score.attr("readonly", "readonly"), this.stars.attr("title", o) }, getScore: function () { var e, n = []; return t(this).each(function () { e = this.score.val(), n.push(e ? parseFloat(e) : void 0) }), n.length > 1 ? n : n[0] }, readOnly: function (n) { return this.each(function () { var o = t(this); if (o.data("readonly") === n) return this; this.cancel && (n ? this.cancel.hide() : this.cancel.show()), n ? (o.unbind(), o.children("img").unbind(), e.fixHint.call(this)) : (e.bindAction.call(this), e.unfixHint.call(this)), o.data("readonly", n) }) }, reload: function () { return e.set.call(this, {}) }, roundStar: function (t) { var e = (t - Math.floor(t)).toFixed(2); if (e > this.opt.round.down) { var n = this.opt.starOn; e < this.opt.round.up && this.opt.halfShow ? n = this.opt.starHalf : e < this.opt.round.full && (n = this.opt.starOff), this.stars.eq(Math.ceil(t) - 1).attr("src", this.opt.path + n) } }, score: function () { return arguments.length ? e.setScore.apply(this, arguments) : e.getScore.call(this) }, set: function (e) { return this.each(function () { var n = t(this), o = n.data("settings"), a = n.clone().removeAttr("style").insertBefore(n); n.remove(), a.raty(t.extend(o, e)) }), t(this.selector) }, setScore: function (n) { return t(this).each(function () { if (!0 === t(this).data("readonly")) return this; e.initialize.call(this, n), e.setTarget.call(this, n, !0) }) }, setTarget: function (n, o) { if (this.opt.target) { var a = t(this.opt.target); 0 == a.length && e.error.call(this, "target selector invalid or missing!"); var r = n; r = o && void 0 !== r ? "hint" == this.opt.targetType ? null === r && this.opt.cancel ? this.opt.cancelHint : this.opt.hints[Math.ceil(r - 1)] : this.opt.precision ? parseFloat(r).toFixed(1) : parseInt(r, 10) : this.opt.targetText, this.opt.targetFormat.indexOf("{score}") < 0 && e.error.call(this, 'template "{score}" missing!'), null !== n && (r = this.opt.targetFormat.toString().replace("{score}", r)), a.is(":input") ? a.val(r) : a.html(r) } }, showHalf: function (t) { var e = (t - Math.floor(t)).toFixed(1); e > 0 && e < .6 && this.stars.eq(Math.ceil(t) - 1).attr("src", this.opt.path + this.opt.starHalf) }, initialize: function (t) { t = t ? e.between(t, 0, this.opt.number) : 0, e.fill.call(this, t), t > 0 && (this.opt.halfShow && e.roundStar.call(this, t), this.score.val(t)) }, unfixHint: function () { for (var e = 0; e < this.opt.number; e++)this.stars.eq(e).attr("title", e < this.opt.hints.length && null !== this.opt.hints[e] ? this.opt.hints[e] : e); t(this).data("readonly", !1).css("cursor", "pointer").removeAttr("title"), this.score.attr("readonly", "readonly") } }; t.fn.raty = function (n) { return e[n] ? e[n].apply(this, Array.prototype.slice.call(arguments, 1)) : "object" != typeof n && n ? void t.error("Method " + n + " does not exist!") : e.init.apply(this, arguments) }, t.fn.raty.defaults = { cancel: !1, cancelHint: "cancel this rating!", cancelOff: "cancel-off.png", cancelOn: "cancel-on.png", cancelPlace: "left", click: void 0, half: !1, halfShow: !0, hints: ["bad", "poor", "regular", "good", "gorgeous"], iconRange: void 0, mouseover: void 0, noRatedMsg: "not rated yet", number: 5, path: "img/", precision: !1, round: { down: .25, full: .6, up: .76 }, readOnly: !1, score: void 0, scoreName: "score", single: !1, size: 16, space: !0, starHalf: "star-half.png", starOff: "star-off.png", starOn: "star-on.png", target: void 0, targetFormat: "{score}", targetKeep: !1, targetText: "", targetType: "hint" } }(jQuery), journalOptions.deleteConfirmText = "Bạn có chắc chắn muốn xóa bình luận?", journalOptions.reportConfirmText = "Bạn có chắc chắn bình luận này vi phạm Tiêu chuẩn cộng đồng và muốn Báo cáo?", journalOptions.reportSuccessfullyText = "Đã báo cáo vi phạm thành công!", journalOptions.contentRequiredText = "Vui lòng nhập nội dung.", journalOptions.contentInvalidText = "Nội dung không hợp lệ.", journalOptions.fullNameRequiredText = "Vui lòng nhập tên của bạn.", journalOptions.emailInvalidText = "Email không hợp lệ.", journalOptions.likeText = "Thích", journalOptions.unlikeText = "Không thích", journalOptions.errorText = "Có lỗi xảy ra. Vui lòng thử lại."; var journalItem = { JournalType: "status", Title: "", Summary: "", Body: "", ItemData: null, Security: "E" }, cancelRequest = !1, isPluginInited = !1; function pluginInit() { var t = "", e = ""; if (globalOpts.fullName && globalOpts.fullName.length) t = unescape(globalOpts.fullName); else { var n = Get_Cookie("CommentName"); n && (t = n) } if (globalOpts.email && globalOpts.email.length) e = unescape(globalOpts.email); else { var o = Get_Cookie("CommentEmail"); n && (e = unescape(o)) } t.length && (t = $("<div />").html(t).text(), $(".txtFullName").val(t), $(".cmtname").val(t)), e.length && (e = $("<div />").html(e).text(), $(".txtEmail").val(e), $(".cmtemail").val(e)) } function SetReferrerPolicy(t) { var e = document.querySelector('meta[name="referrer"]'); if (null != e) 1 == t ? e.setAttribute("content", "no-referrer") : e.setAttribute("content", "no-referrer-when-downgrade"); else { var n = document.createElement("meta"); n.name = "referrer", n.content = 1 == t ? "no-referrer" : "no-referrer-when-downgrade", document.getElementsByTagName("head")[0].appendChild(n) } } function loadMceScript(t) { if ("undefined" == typeof tinymce) { var e = document.createElement("script"); e.type = "text/javascript", e.readyState ? e.onreadystatechange = function () { "loaded" != e.readyState && "complete" != e.readyState || (e.onreadystatechange = null, t()) } : e.onload = function () { t() }, e.src = "//st.imageinstant.net/Data/Sites/1/skins/comic/js/tinymce/tiny_mce_gzip.js"; var n = document.getElementById("comments-js"); n.parentNode.insertBefore(e, n) } else t() } function addreplyclick(t) { SetReferrerPolicy(!0), 0 == isPluginInited && (pluginInit(), isPluginInited = !0); var e = $(t).attr("id").replace("cmtbtn-", ""), n = $("#jcmt-" + e + " .cmteditarea"), o = $("#jcmt-" + e + " .cmtbtn"); return loadMceScript(function () { tinymce.init({ forced_root_block: !1, force_br_newlines: !0, force_p_newlines: !1, entity_encoding: "raw", selector: "#jcmt-" + e + "-txt", menubar: !1, statusbar: !1, plugins: ["autoresize", "emobabysoldier, emoonion, emobafu, emothobua, emothotuzki, emoyoyo, emopanda, emotrollface, emogif", "paste"], paste_as_text: !0, toolbar: "emotrollface emoonion emobafu emothobua emothotuzki emoyoyo emopanda emobabysoldier emogif", setup: function (t) { t.on("init", function () { this.getDoc().body.style.fontSize = "14px" }) }, height: 70, autoresize_min_height: 70, autoresize_max_height: 200, autoresize_bottom_margin: 0, init_instance_callback: function () { setTimeout(function () { tinyMCE.get("jcmt-" + e + "-txt").focus(), $("html, body").animate({ scrollTop: n.offset().top - 80 }, 0, "linear") }, 500) } }) }), n.show(), o.show(), $("html, body").animate({ scrollTop: n.offset().top - 80 }, 0, "linear"), !1 } function journalReport(t) { confirm(journalOptions.reportConfirmText) && journalPost("Report", reportCallback, t.id.replace("report-", "")) } function reportCallback(t, e) { $("#report-" + e).removeAttr("onclick").html(journalOptions.reportSuccessfullyText) } function journalDelete(t) { confirm(journalOptions.deleteConfirmText) && journalPost("Delete", deleteCallback, t.parentNode.parentNode.id.replace("jid-", "")) } function deleteCallback(t, e) { $("#jid-" + e).slideUp(function () { $(this).remove() }) } function journalPost(t, e, n) { 0 == AjaxHelper.loadWaiting && (AjaxHelper.setLoadWaiting(!0), $.ajax({ type: "POST", url: "/Comic/Services/CommentService.asmx/" + t, data: { commentId: n }, beforeSend: AjaxHelper.setHeaders, success: function (t) { void 0 !== e && e(t, n) }, complete: function (t) { AjaxHelper.setLoadWaiting(!1) }, error: function (t, e, n) { AjaxHelper.processAjaxError(n) } })) } function shortenCommentText() { $.fn.shorten = function (t) { var e = { maxHeight: 60, ellipsesText: "...", moreText: "Xem thêm <i class='fa fa-angle-right'></i>", lessText: "<i class='fa fa-angle-left'></i> Thu gọn" }; return t && $.extend(e, t), $(document).off("click", ".morelink"), $(document).on({ click: function () { var t = $(this); return t.hasClass("less") ? (t.removeClass("less"), t.html(e.moreText), t.prev().addClass("shortened")) : (t.addClass("less"), t.html(e.lessText), t.prev().removeClass("shortened")), !1 } }, ".morelink"), this.each(function () { var t = $(this); t.hasClass("shortened") || t.height() > e.maxHeight && (t.addClass("shortened"), $('<a href="#" class="morelink">' + e.moreText + "</a>").insertAfter(t)) }) }, $(".journalrow .summary").shorten({ maxHeight: 150 }) } function childCommentsInit() { $(".jcmt").each(function (t) { $(this).journalComments(commentOpts) }) } !function (t, e) { "use strict"; t.fn.journalTools = function (e) { t.fn.journalTools.defaultOptions = { placeHolder: ".journalPlaceholder", shareButton: ".btnShare", info: ".journalInfo", fullName: ".txtFullName", email: ".txtEmail", content: ".journalContent", items: ".journalItems", pager: ".commentpager a" }; var n = t.extend({}, t.fn.journalTools.defaultOptions, e), o = this.find(n.placeHolder), a = this.find(n.shareButton), r = this.find(n.info), i = this.find(n.fullName), l = this.find(n.email), c = (this.find(n.content), this.find(n.items)), s = this.find(n.pager); o.click(function () { p(), 0 == isPluginInited && (pluginInit(), isPluginInited = !0) }); var p = function () { SetReferrerPolicy(!0), loadMceScript(function () { tinymce.init({ forced_root_block: !1, force_br_newlines: !0, force_p_newlines: !1, entity_encoding: "raw", selector: "textarea.journalContent", menubar: !1, statusbar: !1, plugins: ["autoresize", "emobabysoldier, emoonion, emobafu, emothobua, emothotuzki, emoyoyo, emopanda, emotrollface, emogif", "paste"], paste_as_text: !0, toolbar: "emotrollface emoonion emobafu emothobua emothotuzki emoyoyo emopanda emobabysoldier emogif", setup: function (t) { t.on("init", function () { this.getDoc().body.style.fontSize = "14px" }) }, height: 100, autoresize_min_height: 100, autoresize_max_height: 300, autoresize_bottom_margin: 0, init_instance_callback: function () { setTimeout(function () { tinyMCE.get("journalContent").focus(), t("html, body").animate({ scrollTop: t(".journalEditor").offset().top - 80 }, 0, "linear") }, 500) } }) }), o.hide(), r.show() }; a.click(function (e) { if (e.preventDefault(), cancelRequest) return !1; cancelRequest = !0; var n = {}; return n.comicId = journalOptions.comicId, n.chapterId = journalOptions.chapterId, n.fullName = encodeURIComponent(i.val()), n.email = encodeURIComponent(l.val()), n.content = encodeURIComponent(tinymce.get("journalContent").getContent()), "" == n.content ? (alert(journalOptions.contentRequiredText), tinymce.execCommand("mceFocus", !1, "journalContent"), cancelRequest = !1, !1) : "" == n.fullName ? (alert(journalOptions.fullNameRequiredText), i.focus(), cancelRequest = !1, !1) : void (0 == AjaxHelper.loadWaiting && (AjaxHelper.setLoadWaiting(!0), tinymce.triggerSave(), t.ajax({ type: "POST", url: "/Comic/Services/CommentService.asmx/Create", data: n, beforeSend: AjaxHelper.setHeaders, success: function (e) { if (e.success) { t(e.response).hide().prependTo(c).fadeIn(), tinymce.get("journalContent").setContent(""), journalOptions.fullName = i.val(), journalOptions.email = l.val(), pluginInit(); var n = t(e.response).find(".jcmt").attr("id"); n && t("#" + n).journalComments(commentOpts) } else alert(e.message) }, complete: function (t) { AjaxHelper.setLoadWaiting(!1) }, error: function (t, e, n) { AjaxHelper.processAjaxError(n) } }).always(function (t) { cancelRequest = !1 }))) }), s.length && t(".sort-comment").parent().removeClass("hidden"), t("body").on("click", ".sort-comment", function (e) { t(".sort-comment .icons").toggleClass("active"), t(".commentpager ul li a").trigger("click") }), t("body").on("click", ".commentpager ul li a", function (e) { e.preventDefault(); var n = t(this).attr("href").split("#"); if (0 == isNaN(parseInt(n[1])) && parseInt(n[1]) > 0) { if (0 != AjaxHelper.loadWaiting) return; AjaxHelper.setLoadWaiting(!0); var o = 0; t(".sort-comment .icons").hasClass("active") && (o = 5); var a = parseInt(n[1]); t.ajax({ type: "GET", url: "/Comic/Services/CommentService.asmx/GetList", data: { comicId: journalOptions.comicId, orderBy: o, chapterId: 0, parentId: 0, pageNumber: a }, beforeSend: AjaxHelper.setHeaders, success: function (e) { e.success && (c.html(e.response), t(".commentpager").html(e.pager), t("html, body").animate({ scrollTop: c.offset().top - 80 }, 0, "linear"), pluginInit(), childCommentsInit(), shortenCommentText()), "undefined" != typeof callback && callback(e) }, complete: function (t) { AjaxHelper.setLoadWaiting(!1) }, error: function (t, e, n) { AjaxHelper.processAjaxError(n) } }) } }) }, t.fn.journalComments = function (e) { t.fn.journalComments.defaultOptions = { maxLength: 2e3 }; t.extend({}, t.fn.journalComments.defaultOptions, e); var n = t(this).attr("id"), o = (t("#" + n + "-txt"), t("#" + n + " .cmtbtn a")), a = (t("#" + n + " .cmtbtn .cmtinfo"), t("#" + n + " .cmtbtn input.cmtname")), r = t("#" + n + " .cmtbtn input.cmtemail"), i = t("#" + n + " .miniclose"); function l() { if (confirm(journalOptions.deleteConfirmText)) { if (0 != AjaxHelper.loadWaiting) return; AjaxHelper.setLoadWaiting(!0); var e = t(this).parent().attr("id").replace("cmt-", ""); t.ajax({ type: "POST", url: "/Comic/Services/CommentService.asmx/Delete", beforeSend: AjaxHelper.setHeaders, data: { commentId: e }, success: function (t) { }, complete: function (t) { AjaxHelper.setLoadWaiting(!1) }, error: function (t, e, n) { AjaxHelper.processAjaxError(n) } }), t(this).parent().fadeOut(function () { var e = t(this).parent(), n = t(this).attr("id"); t(this).animate({ height: "0" }, 400, function () { e.remove("#" + n) }) }) } } o.unbind("click"), i.bind("click", l), o.click(function (e) { if (e.preventDefault(), cancelRequest) return !1; cancelRequest = !0; var o = n.replace("jcmt-", ""), i = {}; return i.comicId = journalOptions.comicId, i.chapterId = journalOptions.chapterId, i.commentId = o, i.Comment = encodeURIComponent(tinymce.get(n + "-txt").getContent()), i.fullName = encodeURIComponent(a.val()), i.email = encodeURIComponent(r.val()), "" == i.Comment ? (alert(journalOptions.contentRequiredText), tinymce.execCommand("mceFocus", !1, n + "-txt"), cancelRequest = !1, !1) : "" == i.fullName ? (alert(journalOptions.fullNameRequiredText), a.focus(), cancelRequest = !1, !1) : void (0 == AjaxHelper.loadWaiting && (AjaxHelper.setLoadWaiting(!0), t.ajax({ type: "POST", url: "/Comic/Services/CommentService.asmx/CommentSave", beforeSend: AjaxHelper.setHeaders, data: { comicId: i.comicId, chapterId: i.chapterId, commentId: i.commentId, fullName: i.fullName, email: i.email, content: i.Comment }, success: function (e) { e.success ? function (e) { if (tinymce.get(n + "-txt").setContent(""), t("#" + n + " .cmteditarea").hide(), t("#" + n + " .cmtbtn").hide(), "" != e && " " != e) { var o = t(e); o.insertAfter("#" + n + " .cmtbtn"), t(o).find(".miniclose").bind("click", l) } }(e.response) : alert(e.message) }, complete: function (t) { AjaxHelper.setLoadWaiting(!1) }, error: function (t, e, n) { AjaxHelper.processAjaxError(n) } }).always(function (t) { cancelRequest = !1 }))) }) } }(jQuery, window), $(document).ready(function () { childCommentsInit(); var t = { placeHolder: ".commentpanel .journalPlaceholder", shareButton: ".commentpanel .btnShare", info: ".commentpanel .journalInfo", fullName: ".commentpanel .txtFullName", email: ".commentpanel .txtEmail", content: ".commentpanel .journalContent", items: ".journalItems", pager: ".commentpager a" }; $("body").journalTools(t), shortenCommentText() });